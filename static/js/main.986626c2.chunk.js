(this["webpackJsonphymnal-app"]=this["webpackJsonphymnal-app"]||[]).push([[1],{112:function(e,t,n){},114:function(e,t,n){"use strict";n.r(t);var s=n(0),o=n(26),c=n.n(o),r=n(29),i=n(7),a=(n(60),n(61),n(62),n(63),n(64),n(65),n(66),n(67),n(68),n(69),n(70),n(2)),l=(n(25),n(8)),u=n(32),j=n.n(u);var d=n(54),b=n(1);var h=()=>{const e=new d.a({auth:(t="U2FsdGVkX1+bPnD7qF/W1r3lCIYIwy88qJ1SO+d9HiCkYac2WeRs2MOpFHVq5TjdPNV0vrizHfRlMCgxInEAIQ==",n="jesus private key",j.a.AES.decrypt(t,n).toString(j.a.enc.Utf8))});var t,n;const[o,c]=Object(s.useState)(""),[r,i]=Object(s.useState)(""),[l,u]=Object(s.useState)(""),[h,g]=Object(s.useState)(""),[O,f]=Object(s.useState)(!1);return Object(b.jsxs)("div",{id:"feedbackFormDiv",children:[Object(b.jsxs)(a.r,{children:[Object(b.jsx)(a.s,{position:"floating",children:"Name (Optional)"}),Object(b.jsx)(a.q,{type:"text",value:o,placeholder:"Enter your name",onIonChange:e=>c(e.detail.value)})]}),Object(b.jsxs)(a.r,{children:[Object(b.jsx)(a.s,{position:"floating",children:"Subject/Title"}),Object(b.jsx)(a.q,{type:"text",value:l,placeholder:"Enter Subject/Title",onIonChange:e=>u(e.detail.value)})]}),Object(b.jsxs)(a.r,{children:[Object(b.jsx)(a.s,{position:"floating",children:"What do you think?"}),Object(b.jsx)(a.y,{rows:7,value:r,placeholder:"Enter feedback",onIonChange:e=>i(e.detail.value)})]}),Object(b.jsx)(a.a,{expand:"full",onClick:function(){if(""===l||""===r)g("Please include a title/subject and a feedback message!");else{const t=o||"anonymous";e.rest.issues.create({owner:"Church-Life-Apps",repo:"Songs",title:l,body:`> ${r}\n\n\u2014 ${t}`}).then((function(e){console.debug("GitHub issue created successfully.",e.status,e.data.body),g("Feedback Submitted Sucessfully, Thanks!")}),(function(e){g(`Error Submitting Feedback: ${e}`),console.error("Error making GitHub issue: ",e)})),c(""),i(""),u("")}f(!0)},children:"Submit Feedback"}),Object(b.jsxs)(a.u,{id:"feedbackResponseModal",isOpen:O,onDidDismiss:m,children:[Object(b.jsx)("h1",{className:"center",children:h}),Object(b.jsx)(a.a,{id:"feedbackResponseOKButton",onClick:m,children:"OK"})]})]});function m(){g(""),f(!1)}},g=n(52);const{Storage:O}=g.a,f="dark",m="light",p="theme";var x=()=>{const[e,t]=Object(s.useState)("");return Object(b.jsxs)(a.i,{children:[""===e?Object(b.jsxs)(a.t,{children:[Object(b.jsx)(a.r,{id:"settingsTitle",children:Object(b.jsx)(a.s,{children:"Settings"})}),Object(b.jsx)(a.r,{children:Object(b.jsx)(a.a,{onClick:()=>t("feedback"),children:"Submit Feedback"})}),Object(b.jsxs)(a.r,{children:[Object(b.jsx)(a.n,{slot:"start",icon:l.p}),Object(b.jsx)(a.s,{children:"Dark Mode"}),Object(b.jsx)(a.A,{slot:"end",name:"darkMode",onIonChange:()=>{const e=Object.values(document.body.classList).includes(f)?m:f;window.localStorage.setItem(p,e),document.body.classList.toggle(f)},checked:Object.values(document.body.classList).includes(f)})]})]}):null,"feedback"===e?Object(b.jsx)(h,{}):null,""!==e?Object(b.jsx)(a.a,{color:"light",expand:"full",id:"backToSettingsButton",onClick:()=>t(""),children:"Return to Settings"}):null]})};let y=function(e){return e[e.Music=0]="Music",e[e.Lyrics=1]="Lyrics",e}({});const k={title:"",author:"",songNumber:0,lyrics:new Map,presentation:""},v="https://raw.githubusercontent.com/Church-Life-Apps/Resources/master/resources/songbooks.json",w=[{name:"Songs and Hymns of Life",bookId:"shl",lyricsUrl:"https://raw.githubusercontent.com/Church-Life-Apps/Resources/master/resources/metadata/shl.json",musicUrl:"https://raw.githubusercontent.com/Church-Life-Apps/Resources/master/resources/images/shl/SHL_"}];let S=w,N=!1;const C=!1;async function I(){return N?S:fetch(v).then((async e=>{const t=await e.json(),n=t.songbooks,s=t.testing,o=C?n.concat(s):n;return S=o,N=!0,o})).catch((e=>(console.error(`Failed to get songbooks list due to ${e}`),w)))}async function E(e){return(await I()).find((t=>t.bookId===e))}function M(){return Object(a.E)("desktop")}var _=e=>{const[t,n]=Object(s.useState)(!1),[o,c]=Object(s.useState)("Choose a Songbook!"),{bookId:r}=Object(i.g)(),[u,j]=Object(s.useState)("");return Object(s.useEffect)((()=>{E(r).then((e=>{e&&c(e.name)}))}),[r]),Object(s.useEffect)((()=>{fetch(e.musicPageUrl).then((e=>e.blob())).then((e=>{const t=URL.createObjectURL(e);u!==t&&j(t)})).catch((e=>console.error(e)))}),[e.musicPageUrl]),Object(b.jsxs)(a.B,{children:[Object(b.jsx)(a.z,{id:"appName",children:o}),Object(b.jsx)(a.b,{slot:"start",children:function(){if(!e.backButtonOnClick)return null;return Object(b.jsx)(a.a,{onClick:e.backButtonOnClick,children:Object(b.jsx)(a.n,{icon:l.m})})}()}),Object(b.jsxs)(a.b,{slot:"primary",children:[function(){if(!e.toggleSongModeOnClick)return null;return Object(b.jsxs)(a.a,{id:"songViewToggler",onClick:e.toggleSongModeOnClick,children:[Object(b.jsx)(a.n,{icon:l.q}),Object(b.jsx)(a.n,{icon:l.w}),Object(b.jsx)(a.n,{icon:l.k})]})}(),(M()||Object(a.E)("mobileweb"))&&e.songViewMode===y.Music&&Object(b.jsx)(a.a,{id:"music-download-button",download:e.songDownloadName,href:u,children:Object(b.jsx)(a.n,{icon:l.l})}),Object(b.jsx)(a.a,{onClick:()=>n(!0),children:Object(b.jsx)(a.n,{icon:l.v})})]}),Object(b.jsxs)(a.u,{id:"settingsModal",isOpen:t,onDidDismiss:()=>n(!1),children:[Object(b.jsx)(x,{}),Object(b.jsx)(a.a,{id:"returnToHymnalButton",onClick:()=>n(!1),children:"Back to Hymnal"})]})]})};n(112);var L=()=>{const e=Object(i.f)(),[t,n]=Object(s.useState)(w);return Object(s.useEffect)((()=>{I().then((t=>{1===t.length&&e.push(t[0].bookId),n(t)}))}),[]),Object(b.jsxs)(a.v,{children:[Object(b.jsx)(a.m,{children:Object(b.jsx)(_,{})}),Object(b.jsx)(a.i,{children:Object(b.jsx)(a.t,{children:t.map((t=>{return n=t,Object(b.jsx)(a.c,{onClick:()=>{e.push(n.bookId)},className:"songbookCardView",id:n.bookId,children:Object(b.jsx)(a.g,{children:n.name})},n.name);var n}))})})]})};var B=e=>{const{bookId:t}=Object(i.g)(),[n,o]=Object(s.useState)([]),[c]=Object(s.useState)(e.songs.entries()),r=Object(i.f)();return 0===n.length&&l(c,20),n.length>0?Object(b.jsxs)("div",{children:[Object(b.jsx)(a.t,{id:"searchViewSongList",children:n}),Object(b.jsx)(a.o,{onIonInfinite:function(e){const t=e.target;l(c,10)||(t.disabled=!0);o(Array.from(n)),t.complete()},children:Object(b.jsx)(a.p,{loadingSpinner:"bubbles",loadingText:"Loading more songs..."})})]}):Object(b.jsx)(a.r,{children:Object(b.jsx)(a.s,{children:"No results found"})});function l(e,t){for(;t>0;){const s=e.next();if(s.done)return!1;const o=s.value[1];n.push(u(o)),t--}return!0}function u(e){return Object(b.jsxs)(a.c,{onClick:()=>{r.push(`/${t}/${e.songNumber}`)},className:"hymnalListView",children:[Object(b.jsxs)(a.g,{children:[e.songNumber,". ",e.title]}),Object(b.jsx)(a.f,{children:e.author})]},e.songNumber)}};function T(e){return e.replace(/[!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~]/g,"")}const $=n(113);function U(e,t){return $.compareTwoStrings(T(e.toString().toLowerCase()),t)}function D(e){return e.split(" ")}function R(e){return T(e).toLowerCase().trim()}const F=new Map,V=new Map,A=new Map;async function P(e){const t=F.get(e);if(void 0===t){const t=await E(e);return t?fetch(t.lyricsUrl).then((async n=>{const s=(await n.json())[t.name];return F.set(e,s),s})).catch((e=>(console.error(`Failed to fetch song lyrics due to ${e}`),[]))):(console.error("No songbook found for id "+e),[])}return console.debug("Returning stored lyrics for book "+e),t}async function z(e,t){const n=await P(t);if(""===e)return n;if(isNaN(+e)){const t=new Map;return n.forEach((n=>{t.set(n.songNumber,function(e,t){let n=0;const s=R(t),o=D(s),c=R(e.title),r=D(c),i=R(e.author),a=D(i);if(c.includes(s))n+=H;else for(const l of r)for(const e of o)U(l,e)>q&&(n+=G);if(i.includes(s))n+=W;else for(const l of a)for(const e of o)U(l,e)>q&&(n+=J);V.has(e.songNumber)||V.set(e.songNumber,Object.values(e.lyrics).map((e=>R(String(e)))).join(" "));A.has(e.songNumber)||A.set(e.songNumber,D(V.get(e.songNumber)));if(V.get(e.songNumber).includes(s))n+=X;else for(const l of A.get(e.songNumber))for(const e of o)U(l,e)>q&&(n+=K);return n}(n,e))})),console.debug(t),n.filter((e=>t.get(e.songNumber)>0)).sort(((e,n)=>t.get(n.songNumber)-t.get(e.songNumber)))}return n.filter((t=>t.songNumber.toString().startsWith(e)))}const q=.9,H=1e3,W=900,G=100,J=90,X=500,K=1;var Y=()=>{const[e,t]=Object(s.useState)(""),[n,o]=Object(s.useState)([]),{bookId:c}=Object(i.g)();Object(s.useEffect)((()=>{const t=setTimeout((()=>{z(e,c).then((t=>{o(t),localStorage.setItem("searchString",e)})).catch((e=>console.error(e)))}),200);return()=>clearTimeout(t)}),[e]);const r=Object(i.f)();Object(s.useEffect)((()=>{const e=localStorage.getItem("searchString");e&&t(e)}),[]);const u=()=>{localStorage.removeItem("searchString"),t("")};return Object(b.jsxs)(a.v,{children:[Object(b.jsx)(a.m,{children:Object(b.jsx)(_,{backButtonOnClick:()=>{r.push("/"),u()}})}),Object(b.jsxs)(a.r,{children:[Object(b.jsx)(a.q,{id:"searchBar",type:"search",value:e,placeholder:"Search for a song",onIonChange:e=>t(e.detail.value)}),Object(b.jsx)(a.a,{shape:"round",fill:"clear",color:"medium",onClick:()=>u(),children:Object(b.jsx)(a.n,{icon:l.i})})]}),Object(b.jsx)(a.i,{children:Object(b.jsx)(B,{songs:n},e+n.length)})]})},Q=n(33);const Z=(e,t,n)=>{Q.a.event({category:e,action:t,label:n})};function ee(e,t){try{Z("INTERACTION",`Song viewed(${y[t]})`,e.toString()),console.debug(`Song number: ${String(e)} viewed in ${y[t]} mode`)}catch(n){console.error(n)}}var te=e=>{const[t,n]=Object(s.useState)(k),{bookId:o,songId:c}=Object(i.g)();return Object(s.useEffect)((()=>{ee(e.songNumber,y.Lyrics),async function(e,t){const n=await P(t);return isNaN(e)||e<0||e>n.length?{title:"",author:"",songNumber:-1,lyrics:new Map,presentation:""}:(n[e-1].lyrics instanceof Map||(n[e-1].lyrics=new Map(Object.entries(n[e-1].lyrics))),n[e-1])}(e.songNumber,o).then((e=>{n(e)}))}),[c]),Object(b.jsx)(a.l,{children:Object(b.jsx)(a.w,{class:"ion-justify-content-center",children:Object(b.jsx)(a.h,{size:"12","size-lg":"8","size-xl":"6",className:"song-page-center",children:Object(b.jsxs)(a.c,{id:"lyricViewCard",className:"ion-padding",children:[Object(b.jsxs)(a.e,{className:"ion-text-center",children:[Object(b.jsx)(a.g,{children:null===t||void 0===t?void 0:t.title},"title"),Object(b.jsxs)(a.f,{children:["By ",null===t||void 0===t?void 0:t.author]},"author")]}),Object(b.jsx)(a.d,{children:t?function(e){var t;const n=[];let s=0;const o=e.lyrics,c=null===(t=e.presentation)||void 0===t?void 0:t.split(" ");if(null!=c)c.forEach((e=>{const t=r(e),c=o.get(e)||[""];n.push(l(t,c,s++))}));else{const e=new Map,t=new Map;let c,i;o.forEach(((n,s)=>{s.startsWith("c")?e.set(s,n):t.set(s,n)})),e.size&&([c,i]=e.entries().next().value),t.forEach(((e,t)=>{const o=r(t);if(n.push(l(o,e,s++)),c){const e=r(c);n.push(l(e,i,s++))}})),e.forEach(((e,t)=>{if(t===c)return;const o=r(t);n.push(l(o,e,s++))}))}return n}(t):t},"lyrics")]})})})});function r(e){return e.toLowerCase().replace("v","Verse ").replace("c","Chorus ").replace("b","Bridge ").replace("p","Pre-Chorus ")}function l(e,t,n){const o=t.map(((e,t)=>Object(b.jsx)("p",{children:e},t)));return Object(b.jsxs)(s.Fragment,{children:[Object(b.jsx)("div",{className:"ion-margin-vertical"}),Object(b.jsx)("h5",{className:"ion-margin-top",children:e}),Object(b.jsx)(a.x,{className:"lyricVerse",color:"dark",children:o})]},n)}};const ne=[156,216,278,478];var se=e=>{const t=M()?window.innerWidth/2:window.innerWidth,[n,o]=Object(s.useState)(!1),[c,r]=Object(s.useState)(t),[l,u]=Object(s.useState)(!1),[j,d]=Object(s.useState)(),{bookId:h}=Object(i.g)(),g=ne.includes(e.songNumber)&&"shl"===h,O=g&&n?"-B":"",f=(null===j||void 0===j?void 0:j.musicUrl)+((m=e.songNumber)<10?`00${m}`:m<100?`0${m}`:`${m}`)+O+".png";var m;return Object(s.useEffect)((()=>{e.setMusicPageUrl(f)})),Object(s.useEffect)((()=>{ee(e.songNumber,y.Music)}),[e.songNumber]),Object(s.useEffect)((()=>{E(h).then((e=>{d(e)}))}),[h]),Object(b.jsxs)("div",{children:[g&&Object(b.jsx)("div",{id:"songToggler",children:Object(b.jsx)(a.A,{checked:n,onIonChange:()=>o(!n)})}),Object(b.jsx)("img",{style:{width:c},id:"musicView",className:"song-page-center",onDoubleClick:()=>{r(l?t:2*t),u(!l)},src:f,alt:"No Song Found"})]})};function oe(e,t){const n=e.getBoundingClientRect(),s=t.getBoundingClientRect();return!(n.right<s.left||n.left>s.right||n.bottom<s.top||n.top>s.bottom)}var ce=()=>{const{bookId:e,songId:t}=Object(i.g)(),n=Object(i.f)(),[o,c]=Object(s.useState)(""),[r,u]=Object(s.useState)(y.Lyrics),[j,d]=Object(s.useState)(0),h=+t;return Object(s.useEffect)((()=>(async function(e){return(await P(e)).length}(e).then((e=>d(e))),window.addEventListener("resize",O),()=>{window.removeEventListener("resize",O)})),[e]),Object(s.useEffect)((()=>{!function(e,t,n,s){if(M())return;Object(a.C)({el:document.getElementById("song-page-body"),threshold:10,gestureName:"swipe-gesture",direction:"x",onEnd:o=>{Math.abs(o.velocityX)>.2&&(o.deltaX>10?e>1&&n():e<t&&s())}}).enable()}(h,j,m,f)}),[t,j]),Object(s.useEffect)((()=>{setTimeout(O,1e3)}),[r]),Object(b.jsxs)(a.v,{children:[Object(b.jsx)(a.m,{children:Object(b.jsx)(_,{backButtonOnClick:()=>{n.push(`/${e}`)},toggleSongModeOnClick:function(){r===y.Music?u(y.Lyrics):u(y.Music);try{Z("INTERACTION","Songmode is toggled","SongMode_Toggle")}catch(e){console.error(e)}},songViewMode:r,musicPageUrl:o,songDownloadName:`${e}_${t}`})}),Object(b.jsxs)(a.i,{id:"song-page-body",children:[M()&&function(e){if(e>1)return Object(b.jsx)(a.j,{id:"prevButton",vertical:"center",horizontal:"start",slot:"fixed",children:Object(b.jsx)(a.k,{color:"medium",onClick:m,children:Object(b.jsx)(a.n,{class:"pageTurnButton",icon:l.a})})})}(h),(g=h,r===y.Music?Object(b.jsx)(se,{songNumber:g,setMusicPageUrl:c}):Object(b.jsx)(te,{songNumber:g})),M()&&function(e){if(e<j)return Object(b.jsx)(a.j,{id:"nextButton",vertical:"center",horizontal:"end",slot:"fixed",children:Object(b.jsx)(a.k,{color:"medium",onClick:f,children:Object(b.jsx)(a.n,{class:"pageTurnButton",icon:l.c})})})}(h)]})]});var g;function O(){const e=document.querySelector("#prevButton"),t=document.querySelector("#nextButton"),n=document.querySelector(".song-page-center");e&&(e.style.visibility=oe(e,n)?"hidden":"visible"),t&&(t.style.visibility=oe(t,n)?"hidden":"visible")}function f(){n.push(`/${e}/${Math.max(h+1,1)}`)}function m(){n.push(`/${e}/${Math.min(h-1,j)}`)}};try{Q.a.initialize("UA-183902236-1"),Q.a.pageview(window.location.pathname+window.location.search),console.debug("Page viewed")}catch(ie){console.error(ie)}var re=()=>(console.debug("Current platforms: "+Object(a.D)()),Object(s.useEffect)((()=>{const e=window.matchMedia("(prefers-color-scheme: dark)"),t=window.localStorage.getItem(p);localStorage.removeItem("searchString"),(t===f||e.matches&&t!==m)&&document.body.classList.toggle(f)}),[]),Object(b.jsx)(r.a,{children:Object(b.jsxs)(i.c,{children:[Object(b.jsx)(i.a,{path:"/",component:L,exact:!0}),Object(b.jsx)(i.a,{path:"/:bookId",component:Y,exact:!0}),Object(b.jsx)(i.a,{path:"/:bookId/:songId",component:ce,exact:!0})]})}));c.a.render(Object(b.jsx)(re,{}),document.getElementById("root"))},25:function(e,t,n){},70:function(e,t,n){},71:function(e,t,n){var s={"./ion-action-sheet.entry.js":[116,5],"./ion-alert.entry.js":[117,6],"./ion-app_8.entry.js":[118,7],"./ion-avatar_3.entry.js":[119,17],"./ion-back-button.entry.js":[120,18],"./ion-backdrop.entry.js":[121,43],"./ion-button_2.entry.js":[122,19],"./ion-card_5.entry.js":[123,20],"./ion-checkbox.entry.js":[124,21],"./ion-chip.entry.js":[125,22],"./ion-col_3.entry.js":[126,44],"./ion-datetime_3.entry.js":[127,10],"./ion-fab_3.entry.js":[128,23],"./ion-img.entry.js":[129,45],"./ion-infinite-scroll_2.entry.js":[130,46],"./ion-input.entry.js":[131,24],"./ion-item-option_3.entry.js":[132,25],"./ion-item_8.entry.js":[133,26],"./ion-loading.entry.js":[134,27],"./ion-menu_3.entry.js":[135,28],"./ion-modal.entry.js":[136,8],"./ion-nav_2.entry.js":[137,14],"./ion-popover.entry.js":[138,9],"./ion-progress-bar.entry.js":[139,29],"./ion-radio_2.entry.js":[140,30],"./ion-range.entry.js":[141,31],"./ion-refresher_2.entry.js":[142,11],"./ion-reorder_2.entry.js":[143,16],"./ion-ripple-effect.entry.js":[144,47],"./ion-route_4.entry.js":[145,32],"./ion-searchbar.entry.js":[146,33],"./ion-segment_2.entry.js":[147,34],"./ion-select_3.entry.js":[148,35],"./ion-slide_2.entry.js":[149,48],"./ion-spinner.entry.js":[150,13],"./ion-split-pane.entry.js":[151,49],"./ion-tab-bar_2.entry.js":[152,36],"./ion-tab_2.entry.js":[153,15],"./ion-text.entry.js":[154,37],"./ion-textarea.entry.js":[155,38],"./ion-toast.entry.js":[156,39],"./ion-toggle.entry.js":[157,12],"./ion-virtual-scroll.entry.js":[158,50]};function o(e){if(!n.o(s,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],o=t[0];return n.e(t[1]).then((function(){return n(o)}))}o.keys=function(){return Object.keys(s)},o.id=71,e.exports=o},73:function(e,t,n){var s={"./ion-icon.entry.js":[159,57]};function o(e){if(!n.o(s,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],o=t[0];return n.e(t[1]).then((function(){return n(o)}))}o.keys=function(){return Object.keys(s)},o.id=73,e.exports=o},74:function(e,t){}},[[114,3,4]]]);
//# sourceMappingURL=main.986626c2.chunk.js.map